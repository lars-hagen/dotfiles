#!/bin/bash

USER_INSTRUCTIONS="${1:-No specific instructions. Use base workflow.}"

# Check if we're in the reepay-cli directory
if [[ $(pwd) == */reepay-cli ]]; then
    echo "Running code formatters..."
    poetry run black .
    poetry run ruff check --fix .
fi

echo $SHELL
git diff --cached | /Users/lars/.local/bin/sgpt --shell "
USER INSTRUCTIONS: $USER_INSTRUCTIONS

Interpret user instructions as workflow modifications. Common instructions:
- 'skip pr': Skip pull request creation and merging steps
- 'use commit type X': Use specified commit type instead of default
- 'use branch': Skip branch creation, use current branch and 'git push origin HEAD'

For steps not modified by user instructions, follow this base workflow:

<example>
* Create a commit message based on the staged changes
* Commit the changes
* Push the commit to the current branch
</example>

Output commands with explanatory comments. Generate commit messages from actual diff content.
Prioritize user instructions over base workflow where applicable.
Do not include 'git add' commands unless specifically instructed to do so.
"
